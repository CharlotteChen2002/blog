<p>æœ€è¿‘é—²æ¥æ— äº‹ï¼Œæ¡èµ·äº†ä¸¤å¹´å‰åœ¨å­¦æ“ä½œç³»ç»Ÿå’Œ Rust æ—¶å€™å¼€å‘çš„ Stanford CS 110L è¯¾ç¨‹ã€‚åšäº†ä¸€éå‘ç°é‡Œé¢çš„ <a href="https://reberhardt.com/cs110l/spring-2020/assignments/project-1/" target="_blank" rel="noopener">Project 1: The DEET Debugger</a>ï¼ˆ<a href="https://github.com/reberhardt7/cs110l-spr-2020-starter-code" target="_blank" rel="noopener">ä»£ç ä»“åº“</a>ï¼‰è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œå†™ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹ã€‚</p>
<p>æœ‰ç‚¹æ ‡é¢˜å…šäº†ï¼Œå› ä¸ºè¯¾ç¨‹å·²ç»æä¾›äº†ä»£ç æ¡†æ¶ï¼Œå¤§æ¦‚ä¸èƒ½ç®—æ˜¯ä»é›¶å¼€å§‹äº†ï¼ˆ&lt;ã‚Ï‰ãƒ»ï¼‰â˜†</p>
<!-- more -->
<blockquote>
<p>æœ€æ–°ç‰ˆçš„è¯¾ç¨‹ä¸»é¡µæœªå…¬å¼€åˆå§‹ä»£ç ä»“åº“ï¼Œå› æ­¤ä¸Šé¢ç»™å‡ºçš„æ˜¯ 2020 å¹´çš„ä»£ç ä»“åº“ã€‚ç”±äº <code>Cargo.toml</code> çš„å­˜åœ¨ï¼ŒExercises å’Œ project1 éƒ½ä¸éœ€è¦ä¿®æ”¹å³å¯é£Ÿç”¨ã€‚ä¾èµ–å‡çº§/project 2 çš„é€‚é…å¯ä»¥å‚è€ƒ <a href="https://csdiy.wiki/%E7%BC%96%E7%A8%8B%E5%85%A5%E9%97%A8/CS110L" target="_blank" rel="noopener">CS è‡ªå­¦æŒ‡å—ï¼šCS110L</a> åŠ <a href="https://github.com/fung-hwang/CS110L-2020spr" target="_blank" rel="noopener">fung-hwang/CS110L-2020spr - GitHub</a>ã€‚æˆ‘çš„ä»“åº“ç”±äº project2 é¸½äº†ï¼Œä¸å…¬å¼€äº†ã€‚</p>
</blockquote>
<p>å‚è€ƒï¼š</p>
<ul>
<li><a href="https://reberhardt.com/cs110l/spring-2020/" target="_blank" rel="noopener">CS 110L: Safety in Systems Programming</a></li>
<li><a href="https://man7.org/linux/man-pages/man2/ptrace.2.html" target="_blank" rel="noopener">ptrace(2) â€” Linux manual page</a></li>
</ul>
<h2 id="%E8%B0%83%E8%AF%95%E5%99%A8%E4%B8%8E%E5%AD%90%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%88%9D%E9%81%87" tabindex="-1">è°ƒè¯•å™¨ä¸å­è¿›ç¨‹çš„åˆé‡</h2>
<blockquote>
<p>ï¼ˆMilestone 1: Run the inferiorï¼‰è®©è°ƒè¯•å™¨å¯åŠ¨å­è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨ <code>ptrace</code> ç³»ç»Ÿè°ƒç”¨è§‚å¯Ÿå’Œæ§åˆ¶å­è¿›ç¨‹çš„æ‰§è¡Œã€‚</p>
<p>ï¼ˆæœ¬æ–‡ä¸­çš„å­è¿›ç¨‹ä¸€èˆ¬æŒ‡ä»£çš„éƒ½æ˜¯è¢«è°ƒè¯•çš„è¿›ç¨‹ã€‚ï¼‰</p>
</blockquote>
<p><code>ptrace</code> ç³»ç»Ÿè°ƒç”¨å¯ä»¥ç”¨äºè·Ÿè¸ªæŒ‡å®šçº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€æŒ‡ä»¤æ‰§è¡Œç­‰è¡Œä¸ºï¼Œå¹¶åœ¨è§¦å‘ç‰¹å®šäº‹ä»¶æ—¶é€šè¿‡ä¿¡å·æš‚åœå­è¿›ç¨‹çš„æ‰§è¡Œã€‚æ­¤æ—¶ï¼Œè°ƒè¯•å™¨å¯ä»¥é€šè¿‡ <code>waitpid</code> è·å–å­è¿›ç¨‹çš„çŠ¶æ€ï¼Œå¹¶è¯»å–æˆ–ä¿®æ”¹å­è¿›ç¨‹çš„å†…å­˜ã€å¯„å­˜å™¨ç­‰ä¿¡æ¯ï¼Œæœ€åé€šè¿‡ <code>ptrace</code> ç»§ç»­å­è¿›ç¨‹çš„æ‰§è¡Œã€‚</p>
<p>å¯åŠ¨å­è¿›ç¨‹éœ€è¦çš„ä»£ç ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#1E754F;--shiki-dark:#4D9375"> crate</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">dwarf_data</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">DwarfData</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">sys</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">ptrace</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">sys</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">signal</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">sys</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#999999;--shiki-dark:#666666">{</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">waitpid</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> WaitPidFlag</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> WaitStatus</span><span style="color:#999999;--shiki-dark:#666666">};</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">unistd</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Pid</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">collections</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">HashMap</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">mem</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">size_of</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">os</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">unix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">process</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">CommandExt</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">process</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Child</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">use</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">process</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Command</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// ......</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">/// This function calls ptrace with PTRACE_TRACEME to enable debugging on a process. You should use</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">/// pre_exec with Command to call this in the child process.</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fn</span><span style="color:#59873A;--shiki-dark:#80A665"> child_traceme</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#B07D48;--shiki-dark:#BD976A">io</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">traceme</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">or</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Err</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">io</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Error</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">new</span><span style="color:#999999;--shiki-dark:#666666">(</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">io</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">ErrorKind</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Other</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#B5695977;--shiki-dark:#C98A7D77">        "</span><span style="color:#B56959;--shiki-dark:#C98A7D">ptrace TRACEME failed</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    )))</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">pub</span><span style="color:#AB5959;--shiki-dark:#CB7676"> struct</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    child</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Child</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    // ignore next line for now</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> HashMap</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Breakpoint</span><span style="color:#999999;--shiki-dark:#666666">>,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /// Attempts to start a new inferior process. Returns Some(Inferior) if successful, or None if</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    /// an error is encountered.</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> new</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">target</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">str</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> args</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Vec</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">String</span><span style="color:#999999;--shiki-dark:#666666">>)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Option</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Inferior</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#AB5959;--shiki-dark:#CB7676"> mut</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Command</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">new</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">target</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">args</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">args</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        unsafe</span><span style="color:#999999;--shiki-dark:#666666"> {</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pre_exec</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">child_traceme</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">spawn</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">ok</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ret</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span><span style="color:#B07D48;--shiki-dark:#BD976A"> child</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#B07D48;--shiki-dark:#BD976A"> command</span><span style="color:#999999;--shiki-dark:#666666"> };</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">        ret</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">map</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">|</span><span style="color:#B07D48;--shiki-dark:#BD976A">_</span><span style="color:#AB5959;--shiki-dark:#CB7676">|</span><span style="color:#B07D48;--shiki-dark:#BD976A"> ret</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">ok</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p><code>Inferior</code> æ˜¯ GDB å¯¹è¢«è°ƒè¯•çš„ä¸‹çº§å¯¹è±¡çš„ç§°å‘¼ï¼Œè¿™é‡Œå¯ä»¥ç®€å•ç†è§£æˆè¢«è°ƒè¯•è¿›ç¨‹ã€‚<code>Inferior::new</code> ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œå¹¶åœ¨å­è¿›ç¨‹è¿è¡Œå‰è°ƒç”¨ <code>ptrace::traceme</code> ä»¥å¯ç”¨è°ƒè¯•ã€‚æ­¤æ—¶å­è¿›ç¨‹ä¼šæ”¶åˆ° <code>SIGTRAP</code> è€Œæš‚åœæ‰§è¡Œã€‚è°ƒè¯•å™¨é€šè¿‡ <code>waitpid</code> è·å–å­è¿›ç¨‹çš„çŠ¶æ€ï¼Œå¹¶è¿›è¡Œé”™è¯¯æ£€æŸ¥ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¯´æ˜å­è¿›ç¨‹å·²ç»å‡†å¤‡å°±ç»ªäº†ã€‚</p>
<p>å¼€å§‹ï¼ˆç»§ç»­ï¼‰æ‰§è¡Œå­è¿›ç¨‹çš„ä»£ç ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> go</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Status</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">sys</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">cont</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        // å¼€å§‹ï¼ˆç»§ç»­ï¼‰æ‰§è¡Œï¼Œç›´åˆ°å­è¿›ç¨‹å†æ¬¡ä¸­æ–­/é€€å‡º</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œè°ƒè¯•å™¨ä¼š <code>wait</code> åˆ°å­è¿›ç¨‹çš„æœ€ç»ˆé€€å‡ºï¼Œä½†å¦‚æœåœ¨å­è¿›ç¨‹æš‚åœæ—¶é€€å‡ºè°ƒè¯•å™¨ï¼Œå­è¿›ç¨‹ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚å› æ­¤ï¼Œè°ƒè¯•å™¨éœ€è¦åœ¨é€€å‡ºæ—¶æ€æ­»å­è¿›ç¨‹ã€‚</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> kill</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Killing running inferior (pid </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">());</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        // kill child</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">child</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">kill</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">unwrap</span><span style="color:#999999;--shiki-dark:#666666">();</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">        // reap zombies</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">child</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">unwrap</span><span style="color:#999999;--shiki-dark:#666666">();</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>å¥½ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>Inferior</code> æ¥å°è¯•åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹äº†ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä»‹ç»ç¨‹åºçš„ä¸»è¦ç»“æ„ä½“ <code>Debugger</code>ï¼ŒåŒ…å«äº†è¾“å…¥å¤„ç†ã€å†å²å­˜å‚¨ç­‰æ¨¡å—ï¼ˆç°åœ¨å…ˆä¸ç”¨å…³å¿ƒè¿™äº›ç»†èŠ‚ï¼‰ï¼Œ<code>Debugger::run</code> åˆ™æ˜¯ç¨‹åºçš„ä¸»ä½“é€»è¾‘ã€‚</p>
<p>åœ¨ <code>Debugger::run</code> é‡Œï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç”¨æˆ·è¾“å…¥è¿è¡Œç¨‹åºçš„å‘½ä»¤åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Inferior</code> å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ <code>Inferior::go</code> æ–¹æ³•ï¼Œç­‰å¾…å­è¿›ç¨‹å†æ¬¡ä¸­æ–­æˆ–é€€å‡ºï¼Œæ­¤æ—¶æ ¹æ®å­è¿›ç¨‹çš„çŠ¶æ€ç è¿›è¡Œç›¸åº”çš„å¤„ç†ã€‚</p>
<blockquote>
<p>é™„ï¼šè¿™ä¸ªè°ƒè¯•å™¨çš„ä½¿ç”¨æ–¹æ³•ï¼š</p>
<p><code>deet &lt;target&gt;</code>ï¼šè¿è¡Œè°ƒè¯•å™¨ï¼Œé€šè¿‡å‚æ•°æŒ‡å®šè¦è°ƒè¯•çš„ç›®æ ‡ç¨‹åºï¼Œæ­¤æ—¶è¿›å…¥è°ƒè¯•å™¨çš„ REPL æ¨¡å¼</p>
<p><code>&gt; run &lt;args&gt;</code>ï¼šåœ¨è°ƒè¯•å™¨çš„ REPL shell å†…ï¼Œè¿è¡Œç›®æ ‡ç¨‹åºï¼Œ<code>args</code> ä¸ºç›®æ ‡ç¨‹åºçš„å‚æ•°</p>
</blockquote>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">pub</span><span style="color:#AB5959;--shiki-dark:#CB7676"> struct</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    target</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> String</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    history_path</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> String</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    readline</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Editor</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;()>,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Option</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Inferior</span><span style="color:#999999;--shiki-dark:#666666">>,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    debug_data</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> DwarfData</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        loop</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            match</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_next_command</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">                DebuggerCommand</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Run</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">args</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">x</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">as_mut</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">                        x</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">kill</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">inferior</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">new</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">target</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">args</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">breakpoints</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">inferior</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">go</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span><span style="color:#1E754F;--shiki-dark:#4D9375"> else</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Error starting subprocess</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">                DebuggerCommand</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Quit</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">x</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">as_mut</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">                        x</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">kill</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    return</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> go</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        match</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            .</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            .</span><span style="color:#59873A;--shiki-dark:#80A665">as_mut</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            .</span><span style="color:#59873A;--shiki-dark:#80A665">unwrap</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            .</span><span style="color:#59873A;--shiki-dark:#80A665">go</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            .</span><span style="color:#59873A;--shiki-dark:#80A665">expect</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Error handling subprocess</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        {</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">            Status</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Stopped</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">signal</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> rip</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Child stopped (signal </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> signal</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">                // ignore next line for now</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">file</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">debug_data</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_line_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                    println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Stopped at </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> file</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">            Status</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Exited</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">exit_code</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Child exited (status </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> exit_code</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">            Status</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Signaled</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">signal</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Child exited due to signal </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> signal</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior </span><span style="color:#999999;--shiki-dark:#666666">=</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        };</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>æ ¹æ® CS 110L å®˜ç½‘ï¼ˆä¸‹ç•¥ï¼‰ï¼Œæ­¤æ—¶çš„é¢„æœŸè¾“å‡º:</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ğŸŒ</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ./container</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cargo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    Finished</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dev</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> [unoptimized </span><span style="color:#B56959;--shiki-dark:#C98A7D">+</span><span style="color:#B56959;--shiki-dark:#C98A7D"> debuginfo]</span><span style="color:#B56959;--shiki-dark:#C98A7D"> target</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">s</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B56959;--shiki-dark:#C98A7D"> in</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 1.94s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">     Running</span><span style="color:#999999;--shiki-dark:#666666"> `</span><span style="color:#59873A;--shiki-dark:#80A665">target/debug/deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span><span style="color:#999999;--shiki-dark:#666666">`</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> r</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Child</span><span style="color:#B56959;--shiki-dark:#C98A7D"> exited</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (status </span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> r</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 3</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Child</span><span style="color:#B56959;--shiki-dark:#C98A7D"> exited</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (status </span><span style="color:#2F798A;--shiki-dark:#4C9A91">0</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span></span></code></pre>
<h2 id="%E6%AD%BB%E9%94%81%E4%B9%8B%E9%AD%82%E6%8E%A8%E5%8A%A8%E9%81%87%E9%9A%BE%E8%88%B9" tabindex="-1">æ­»é”ä¹‹é­‚æ¨åŠ¨é‡éš¾èˆ¹</h2>
<blockquote>
<p>ï¼ˆMilestone 2: Stopping, resuming, and restarting the inferiorï¼‰ä½¿è°ƒè¯•å™¨èƒ½å¤Ÿæš‚åœã€ç»§ç»­ã€é‡å¯å­è¿›ç¨‹ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿåœ¨å­è¿›ç¨‹æ­»é”æˆ–å…¶ä»–ç±»ä¼¼æƒ…å†µæ—¶ï¼Œèƒ½å¤Ÿä¸»åŠ¨æš‚åœå­è¿›ç¨‹çš„æ‰§è¡Œï¼Œè¿›è¡Œä¸€äº›è°ƒè¯•å·¥ä½œï¼Œå¹¶ä¸”ä¹‹åå†³å®šæ˜¯æ¢å¤æ‰§è¡Œè¿˜æ˜¯é‡å¯ä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ã€‚</p>
<p>é¦–å…ˆåœ¨ <code>debugger_command.rs</code> ä¸­å¢åŠ  c/cont/continue å‘½ä»¤ã€‚ç”±äºé€»è¾‘ç®€å•ï¼Œè¿™é‡Œä¸å†å±•ç¤ºã€‚</p>
<p>æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯å¤„ç†å®ç° continue å‘½ä»¤äº†ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        loop</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            match</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_next_command</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                ..........</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">                DebuggerCommand</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Cont</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">is_none</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">There is no subprocess running now</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        continue</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                    self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">go</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>å’Œ <code>Debugger::run</code> ç›¸æ¯”ï¼Œåªæ˜¯å°‘äº†åˆ›å»ºæ–°çš„ <code>Inferior</code> å¯¹è±¡çš„æ­¥éª¤ã€‚</p>
<p>æ¢å¤æ‰§è¡Œ/é‡å¯æ–°çš„å­è¿›ç¨‹æ˜¯ trivial çš„ï¼Œå®é™…æ‰§è¡Œä»ç„¶æ˜¯è°ƒè¯•å™¨çš„ REPL shell ä¸­çš„ run/continue å‘½ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œçš„å…³é”®æ˜¯å¤„ç†å¥½å­è¿›ç¨‹çš„çŠ¶æ€ï¼Œå¯¹æ¢å¤æ‰§è¡Œè€Œè¨€ï¼Œå°±æ˜¯è¦åˆ¤æ–­å­è¿›ç¨‹æ˜¯å¦å·²å­˜åœ¨ï¼Œå¯¹é‡å¯è€Œè¨€ï¼Œå°±æ˜¯å¦‚æœå­è¿›ç¨‹å·²ç»å­˜åœ¨ï¼Œè¦å…ˆ kill æ‰ã€‚</p>
<p>è¿™éƒ¨åˆ†é€»è¾‘å·²ç»åœ¨ç¬¬ä¸€èŠ‚å®ç°ã€‚</p>
<p>æ­¤æ—¶çš„é¢„æœŸè¾“å‡ºï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ğŸŒ</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ./container</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cargo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">   Compiling</span><span style="color:#B56959;--shiki-dark:#C98A7D"> deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> v0.1.0</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (/deet)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    Finished</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dev</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> [unoptimized </span><span style="color:#B56959;--shiki-dark:#C98A7D">+</span><span style="color:#B56959;--shiki-dark:#C98A7D"> debuginfo]</span><span style="color:#B56959;--shiki-dark:#C98A7D"> target</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">s</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B56959;--shiki-dark:#C98A7D"> in</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 29.80s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">     Running</span><span style="color:#999999;--shiki-dark:#666666"> `</span><span style="color:#59873A;--shiki-dark:#80A665">target/debug/deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span><span style="color:#999999;--shiki-dark:#666666">`</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 5</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">^CChild</span><span style="color:#B56959;--shiki-dark:#C98A7D"> stopped</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (signal </span><span style="color:#B56959;--shiki-dark:#C98A7D">SIGINT</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 5</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Killing</span><span style="color:#B56959;--shiki-dark:#C98A7D"> running</span><span style="color:#B56959;--shiki-dark:#C98A7D"> inferior</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (pid </span><span style="color:#2F798A;--shiki-dark:#4C9A91">204</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">0</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">1</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">^CChild</span><span style="color:#B56959;--shiki-dark:#C98A7D"> stopped</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (signal </span><span style="color:#B56959;--shiki-dark:#C98A7D">SIGINT</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span></span></code></pre>
<p>æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ğŸŒ</span><span style="color:#B56959;--shiki-dark:#C98A7D"> docker</span><span style="color:#B56959;--shiki-dark:#C98A7D"> exec</span><span style="color:#B56959;--shiki-dark:#C98A7D"> deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ps</span><span style="color:#B56959;--shiki-dark:#C98A7D"> aux</span><span style="color:#AB5959;--shiki-dark:#CB7676"> |</span><span style="color:#59873A;--shiki-dark:#80A665"> grep</span><span style="color:#B56959;--shiki-dark:#C98A7D"> sleepy_print</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">501</span><span style="color:#2F798A;--shiki-dark:#4C9A91">          1</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  0.6</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  0.2</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  16292</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  4448</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pts/0</span><span style="color:#B56959;--shiki-dark:#C98A7D">    Ss+</span><span style="color:#B56959;--shiki-dark:#C98A7D">  10:29</span><span style="color:#B56959;--shiki-dark:#C98A7D">   0:00</span><span style="color:#B56959;--shiki-dark:#C98A7D"> target/debug/deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">501</span><span style="color:#2F798A;--shiki-dark:#4C9A91">        210</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  0.0</span><span style="color:#2F798A;--shiki-dark:#4C9A91">  0.0</span><span style="color:#2F798A;--shiki-dark:#4C9A91">   4504</span><span style="color:#2F798A;--shiki-dark:#4C9A91">   704</span><span style="color:#B56959;--shiki-dark:#C98A7D"> pts/0</span><span style="color:#B56959;--shiki-dark:#C98A7D">    t+</span><span style="color:#B56959;--shiki-dark:#C98A7D">   10:29</span><span style="color:#B56959;--shiki-dark:#C98A7D">   0:00</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/sleepy_print</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 5</span></span></code></pre>
<blockquote>
<p>There should only be one samples/sleepy_print process. If you see multiple, or you see a <defunct> entry, then you are not killing or reaping child processes properly.</p>
</blockquote>
<h2 id="%E9%82%A3%E4%B8%AA%E8%B0%83%E7%94%A8%E6%A0%88%E6%BB%94%E6%BB%94%E4%B8%8D%E7%BB%9D%E7%9A%84%E8%A1%A8%E8%BE%BE%E7%88%B1%E6%84%8F" tabindex="-1">é‚£ä¸ªè°ƒç”¨æ ˆæ»”æ»”ä¸ç»çš„è¡¨è¾¾çˆ±æ„</h2>
<blockquote>
<p>ï¼ˆMilestone 3: Printing a backtrace &amp; Milestone 4: Print stopped locationï¼‰æ‰“å°å­è¿›ç¨‹çš„è°ƒç”¨æ ˆã€‚</p>
</blockquote>
<p>è¿™ä¸€èŠ‚ï¼Œæˆ‘ä»¬æ­£å¼å¼€å§‹è°ƒè¯•å·¥ä½œäº†ã€‚è®©æˆ‘ä»¬é¦–å…ˆçœ‹çœ‹åœ¨å­è¿›ç¨‹æš‚åœæˆ–é€€å‡ºæ—¶çš„ä¸€äº›è¿è¡Œä¿¡æ¯ï¼Œä¾‹å¦‚è°ƒç”¨æ ˆï¼ˆå³å­è¿›ç¨‹å¯„åœ¨å“ªäº†ï¼‰ã€‚</p>
<p>åŒä¸Šï¼Œçœç•¥ bt/back/backtrace å‘½ä»¤çš„å¢åŠ ã€‚</p>
<p>ä¸ºäº†å¾—åˆ°è°ƒç”¨æ ˆçš„å‡½æ•°åå’Œè¡Œå·ï¼Œæˆ‘ä»¬éœ€è¦è·å¾—è°ƒè¯•ä¿¡æ¯ã€‚</p>
<p>ä¸ºäº†å¼•å…¥æ¡†æ¶æä¾›çš„åº“ï¼Œéœ€è¦åœ¨ <code>main.rs</code> ä¸­å¢åŠ ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">mod</span><span style="color:#59873A;--shiki-dark:#80A665"> dwarf_data</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">mod</span><span style="color:#59873A;--shiki-dark:#80A665"> gimli_wrapper</span><span style="color:#999999;--shiki-dark:#666666">;</span></span></code></pre>
<p>ç„¶åæŠŠè°ƒè¯•ä¿¡æ¯ä¿å­˜åœ¨ <code>Debugger</code> ç»“æ„ä½“ä¸­ã€‚</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">// Debugger::new ä¸­</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> debug_data</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> match</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> DwarfData</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">from_file</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">target</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">    Ok</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">val</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#B07D48;--shiki-dark:#BD976A"> val</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">    Err</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">DwarfError</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">ErrorOpeningFile</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Could not open file </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> target</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">process</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">exit</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">    Err</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">DwarfError</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">DwarfFormatError</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">err</span><span style="color:#999999;--shiki-dark:#666666">))</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Could not debugging symbols from </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D">: </span><span style="color:#999999;--shiki-dark:#666666">{</span><span style="color:#B56959;--shiki-dark:#C98A7D">:?</span><span style="color:#999999;--shiki-dark:#666666">}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> target</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> err</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">process</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">exit</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">};</span></span></code></pre>
<p>backtrace å‘½ä»¤ä¸­å¯ä»¥æŠŠè°ƒè¯•ä¿¡æ¯ä¼ ç»™ <code>Inferior::print_backtrace</code> æ–¹æ³•ï¼Œæ‰“å°å‡ºè°ƒç”¨æ ˆçš„å‡½æ•°åå’Œè¡Œå·ã€‚</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        loop</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            match</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_next_command</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                ..........</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">                DebuggerCommand</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">BackTrace</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">inferior</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">as_ref</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                        if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Err</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">err</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">print_backtrace</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">debug_data</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                            println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Error printing backtrace: </span><span style="color:#999999;--shiki-dark:#666666">{</span><span style="color:#B56959;--shiki-dark:#C98A7D">:?</span><span style="color:#999999;--shiki-dark:#666666">}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> err</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span><span style="color:#1E754F;--shiki-dark:#4D9375"> else</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">There is no subprocess running now</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> print_backtrace</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> debug_info</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">DwarfData</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#AB5959;--shiki-dark:#CB7676"> mut</span><span style="color:#B07D48;--shiki-dark:#BD976A"> rip</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">getregs</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">())</span><span style="color:#AB5959;--shiki-dark:#CB7676">?.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">rip </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#AB5959;--shiki-dark:#CB7676"> mut</span><span style="color:#B07D48;--shiki-dark:#BD976A"> rbp</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">getregs</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">())</span><span style="color:#AB5959;--shiki-dark:#CB7676">?.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">rbp </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        loop</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            debug_info</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">print_function_and_line_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> function_name</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> debug_info</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                .</span><span style="color:#59873A;--shiki-dark:#80A665">get_function_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                .</span><span style="color:#59873A;--shiki-dark:#80A665">ok_or</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Error</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Sys</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">errno</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">Errno</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#A65E2B;--shiki-dark:#C99076">EINVAL</span><span style="color:#999999;--shiki-dark:#666666">))</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:#B07D48;--shiki-dark:#BD976A"> function_name</span><span style="color:#AB5959;--shiki-dark:#CB7676"> ==</span><span style="color:#B5695977;--shiki-dark:#C98A7D77"> "</span><span style="color:#B56959;--shiki-dark:#C98A7D">main</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                break</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            rip</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">read</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#B07D48;--shiki-dark:#BD976A">rbp</span><span style="color:#AB5959;--shiki-dark:#CB7676"> +</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 8</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">AddressType</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            rbp</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">read</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> rbp</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">AddressType</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">        Ok</span><span style="color:#999999;--shiki-dark:#666666">(())</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>è¿™é‡Œçš„é€»è¾‘æ˜¯éå†è°ƒç”¨å¸§æ ˆï¼Œä¼ªä»£ç ï¼ˆä¸ç†è§£çš„è¯å¯ä»¥å…ˆäº†è§£ä¸‹ x86 çš„å¸§æ ˆå†…å­˜å¸ƒå±€ï¼‰ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-text"><span class="line"><span>instruction_ptr = %rip</span></span>
<span class="line"><span>base_ptr = %rbp</span></span>
<span class="line"><span>while true:</span></span>
<span class="line"><span>    print function/line number for instruction_ptr</span></span>
<span class="line"><span>    if function == "main":</span></span>
<span class="line"><span>        break</span></span>
<span class="line"><span>    instruction_ptr = read memory at base_ptr + 8</span></span>
<span class="line"><span>    base_ptr = read memory at base_ptr</span></span></code></pre>
<p>æ‰“å°ä»£ç ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> DwarfData</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    #[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">allow</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">dead_code</span><span style="color:#999999;--shiki-dark:#666666">)]</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> print_function_and_line_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> curr_addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> function</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_function_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">curr_addr</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_line_from_addr</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">curr_addr</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        match</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#B07D48;--shiki-dark:#BD976A">function</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            (</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">function</span><span style="color:#999999;--shiki-dark:#666666">),</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">line</span><span style="color:#999999;--shiki-dark:#666666">))</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#59873A;--shiki-dark:#80A665"> println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> (</span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D">)</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> function</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#999999;--shiki-dark:#666666">),</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            _</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> (),</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>é¢„æœŸè¾“å‡ºï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-shell"><span class="line"><span style="color:#59873A;--shiki-dark:#80A665">ğŸ‘¾</span><span style="color:#B56959;--shiki-dark:#C98A7D"> ./container</span><span style="color:#B56959;--shiki-dark:#C98A7D"> cargo</span><span style="color:#B56959;--shiki-dark:#C98A7D"> run</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/segfault</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">    Finished</span><span style="color:#B56959;--shiki-dark:#C98A7D"> dev</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> [unoptimized </span><span style="color:#B56959;--shiki-dark:#C98A7D">+</span><span style="color:#B56959;--shiki-dark:#C98A7D"> debuginfo]</span><span style="color:#B56959;--shiki-dark:#C98A7D"> target</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">s</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#B56959;--shiki-dark:#C98A7D"> in</span><span style="color:#B56959;--shiki-dark:#C98A7D"> 2.43s</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">     Running</span><span style="color:#999999;--shiki-dark:#666666"> `</span><span style="color:#59873A;--shiki-dark:#80A665">target/debug/deet</span><span style="color:#B56959;--shiki-dark:#C98A7D"> samples/segfault</span><span style="color:#999999;--shiki-dark:#666666">`</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> r</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Calling</span><span style="color:#B56959;--shiki-dark:#C98A7D"> func2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">About</span><span style="color:#B56959;--shiki-dark:#C98A7D"> to</span><span style="color:#B56959;--shiki-dark:#C98A7D"> segfault...</span><span style="color:#B56959;--shiki-dark:#C98A7D"> a=</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Child</span><span style="color:#B56959;--shiki-dark:#C98A7D"> stopped</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (signal </span><span style="color:#B56959;--shiki-dark:#C98A7D">SIGSEGV</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">Stopped</span><span style="color:#B56959;--shiki-dark:#C98A7D"> at</span><span style="color:#B56959;--shiki-dark:#C98A7D"> /deet/samples/segfault.c:5</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#59873A;--shiki-dark:#80A665"> back</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">func2</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (/deet/samples/segfault.c:5)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">func1</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (/deet/samples/segfault.c:12)</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">main</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE"> (/deet/samples/segfault.c:15)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">deet</span><span style="color:#999999;--shiki-dark:#666666">)</span></span></code></pre>
<h2 id="%E6%96%AD%E7%82%B9%E6%98%AF%E5%81%9A%E4%BA%86%E4%B8%80%E4%B8%AA%E9%A1%BD%E5%9B%BA%E6%9C%8B%E5%8F%8B%E7%9A%84%E6%A2%A6" tabindex="-1">æ–­ç‚¹æ˜¯åšäº†ä¸€ä¸ªé¡½å›ºæœ‹å‹çš„æ¢¦</h2>
<blockquote>
<p>ï¼ˆMilestone 5: Setting breakpoints &amp; Milestone 6: Continuing from breakpoints &amp; Milestone 7: Setting breakpoints on symbolsï¼‰è®¾ç½®å¹¶ç»§ç»­æ–­ç‚¹ã€‚</p>
</blockquote>
<p>æœ¬èŠ‚å·²ç»æ˜¯æœ€åä¸€èŠ‚äº†ï¼Œå°†æ”¯æŒè°ƒè¯•å™¨è®¾ç½®ç‰¹å®šåœ°å€/å‡½æ•°å/è¡Œå·çš„æ–­ç‚¹å¹¶æ¢å¤æ‰§è¡Œã€‚å‡½æ•°åå’Œè¡Œå·å¯ä»¥é€šè¿‡è°ƒè¯•ä¿¡æ¯è½¬åŒ–æˆåœ°å€ï¼Œå› æ­¤è¿™é‡Œçš„æ ¸å¿ƒæ˜¯å®ç°ç‰¹å®šåœ°å€æ–­ç‚¹çš„è®¾ç½®å’Œæ¢å¤æ‰§è¡Œã€‚</p>
<p>è®¾ç½®æ–­ç‚¹å¹¶æ¢å¤æ‰§è¡Œçœ‹èµ·æ¥å¥½åƒå’Œä¹‹å‰çš„ continue å‘½ä»¤å·®ä¸å¤šï¼Œä½†å®é™…ä¸Šè¦å¤æ‚ä¸€äº›ã€‚å› ä¸ºæ–­ç‚¹æ˜¯é€šè¿‡ä¿®æ”¹å­è¿›ç¨‹çš„å†…å­˜å’ŒæŒ‡ä»¤å¯„å­˜å™¨ RIP æ¥å®ç°çš„ï¼Œæ‰€ä»¥ç›¸ä¿¡è¯»å®Œæœ¬èŠ‚ï¼Œä½ ä¹Ÿèƒ½æ˜ç™½å¸¸è§è°ƒè¯•å™¨çš„ä¿®æ”¹å†…å­˜/å¯„å­˜å™¨ç­‰åŠŸèƒ½çš„åŸç†ã€‚è‡³æ­¤ï¼Œè°ƒè¯•å™¨çš„æ ¸å¿ƒåŠŸèƒ½å‡å·²ç»å®ç°äº†ï¼Œå¯å–œå¯è´ºï¼Œå¯å–œå¯è´ºã€‚</p>
<p>åŒä¸Šï¼Œçœç•¥ b/break å‘½ä»¤çš„å¢åŠ ã€‚</p>
<p>æ³¨æ„ <code>Debugger</code> ç»“æ„ä½“ä¸­éœ€è¦å¢åŠ æ–­ç‚¹çš„å­˜å‚¨ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬éœ€è¦åœ¨ <code>Inferior</code> åˆ›å»ºå‰å°±æ”¯æŒæ–­ç‚¹çš„è®¾ç½®ã€‚</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> run</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        loop</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            match</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_next_command</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                ..........</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">                DebuggerCommand</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">BreakPoint</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">arg</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> =></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">                    if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Debugger</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">parse_address</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">arg</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                        .</span><span style="color:#59873A;--shiki-dark:#80A665">or</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">parse_line_number</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">arg</span><span style="color:#999999;--shiki-dark:#666666">))</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">                        .</span><span style="color:#59873A;--shiki-dark:#80A665">or</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">parse_function_name</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">arg</span><span style="color:#999999;--shiki-dark:#666666">))</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    {</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">                        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">set_breakpoint</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span><span style="color:#1E754F;--shiki-dark:#4D9375"> else</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Invalid breakpoint location: </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> arg</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">                }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> set_breakpoint</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Set breakpoint </span><span style="color:#999999;--shiki-dark:#666666">{}</span><span style="color:#B56959;--shiki-dark:#C98A7D"> at 0x</span><span style="color:#999999;--shiki-dark:#666666">{</span><span style="color:#B56959;--shiki-dark:#C98A7D">:x</span><span style="color:#999999;--shiki-dark:#666666">}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">len</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">push</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">inferior</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">as_mut</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Err</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">err</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> inferior</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">set_breakpoint</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">                println!</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">Error setting breakpoint: </span><span style="color:#999999;--shiki-dark:#666666">{</span><span style="color:#B56959;--shiki-dark:#C98A7D">:?</span><span style="color:#999999;--shiki-dark:#666666">}</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> err</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">            }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> parse_address</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">str</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Option</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> !</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">starts_with</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#999999;--shiki-dark:#666666">'</span><span style="color:#B56959;--shiki-dark:#C98A7D">*</span><span style="color:#999999;--shiki-dark:#666666">'</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">            return</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">1</span><span style="color:#AB5959;--shiki-dark:#CB7676">..</span><span style="color:#999999;--shiki-dark:#666666">];</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr_without_0x</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#1E754F;--shiki-dark:#4D9375"> if</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">to_lowercase</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">starts_with</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#B56959;--shiki-dark:#C98A7D">0x</span><span style="color:#B5695977;--shiki-dark:#C98A7D77">"</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">            &#x26;</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">[</span><span style="color:#2F798A;--shiki-dark:#4C9A91">2</span><span style="color:#AB5959;--shiki-dark:#CB7676">..</span><span style="color:#999999;--shiki-dark:#666666">]</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span><span style="color:#1E754F;--shiki-dark:#4D9375"> else</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            addr</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        };</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">        usize</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">from_str_radix</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr_without_0x</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 16</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">ok</span><span style="color:#999999;--shiki-dark:#666666">()</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> parse_line_number</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">str</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Option</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">parse</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">>()</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">ok</span><span style="color:#999999;--shiki-dark:#666666">()</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">debug_data</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_addr_for_line</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> line</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> parse_function_name</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> func</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">str</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Option</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">debug_data</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get_addr_for_function</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> func</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœ <code>Inferior</code> è¿˜ä¸å­˜åœ¨ï¼Œç›´æ¥å­˜åœ¨ <code>breakpoints</code> ä¸­ï¼Œç­‰ <code>Inferior</code> åˆ›å»ºåå†è®¾ç½®æ–­ç‚¹ã€‚ä½†å¦‚æœ <code>Inferior</code> å·²ç»å­˜åœ¨ï¼Œå°±è¿˜éœ€è¦é€šçŸ¥ <code>Inferior</code> è®¾ç½®æ–­ç‚¹ï¼ˆå› ä¸º <code>Inferior</code> åˆå§‹åŒ–æ—¶åªèƒ½ä¼ å…¥åˆå§‹åŒ–æ—¶çš„ <code>breakpoints</code> æ–­ç‚¹æ•°ç»„ï¼‰ã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ <code>Inferior</code> ä¸­æ€ä¹ˆè®¾ç½®æ–­ç‚¹ï¼š</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">fn</span><span style="color:#59873A;--shiki-dark:#80A665"> align_addr_to_word</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    addr</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#AB5959;--shiki-dark:#CB7676">-</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#59873A;--shiki-dark:#80A665">size_of</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">>()</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> isize</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">#[</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">derive</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Clone</span><span style="color:#999999;--shiki-dark:#666666">)]</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">struct</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Breakpoint</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    orig_byte</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> u8</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">pub</span><span style="color:#AB5959;--shiki-dark:#CB7676"> struct</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    child</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Child</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">    breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> HashMap</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">usize</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Breakpoint</span><span style="color:#999999;--shiki-dark:#666666">>,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#A0ADA0;--shiki-dark:#758575DD">    // éœ€è¦æ›´æ”¹ Inferior::newï¼Œå¯¹ä¼ å…¥çš„æ¯ä¸ªæ–­ç‚¹åœ°å€è®¾ç½®æ–­ç‚¹</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> set_breakpoint</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> orig_byte</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">write_byte</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0xcc</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">insert</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Breakpoint</span><span style="color:#999999;--shiki-dark:#666666"> {</span><span style="color:#B07D48;--shiki-dark:#BD976A"> orig_byte</span><span style="color:#999999;--shiki-dark:#666666"> });</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">        Ok</span><span style="color:#999999;--shiki-dark:#666666">(())</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    fn</span><span style="color:#59873A;--shiki-dark:#80A665"> write_byte</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> val</span><span style="color:#AB5959;--shiki-dark:#CB7676">:</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> u8</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">u8</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> aligned_addr</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> align_addr_to_word</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">addr</span><span style="color:#999999;--shiki-dark:#666666">);</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte_offset</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> addr</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#B07D48;--shiki-dark:#BD976A"> aligned_addr</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> word</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">read</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> aligned_addr</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">AddressType</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> u64</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> orig_byte</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#B07D48;--shiki-dark:#BD976A">word</span><span style="color:#AB5959;--shiki-dark:#CB7676"> >></span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#2F798A;--shiki-dark:#4C9A91">8</span><span style="color:#AB5959;--shiki-dark:#CB7676"> *</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte_offset</span><span style="color:#999999;--shiki-dark:#666666">))</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0xff</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> masked_word</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> word</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x26;</span><span style="color:#AB5959;--shiki-dark:#CB7676"> !</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2F798A;--shiki-dark:#4C9A91">0xff</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x3C;&#x3C;</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#2F798A;--shiki-dark:#4C9A91">8</span><span style="color:#AB5959;--shiki-dark:#CB7676"> *</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte_offset</span><span style="color:#999999;--shiki-dark:#666666">));</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> updated_word</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> masked_word</span><span style="color:#AB5959;--shiki-dark:#CB7676"> |</span><span style="color:#999999;--shiki-dark:#666666"> ((</span><span style="color:#B07D48;--shiki-dark:#BD976A">val</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> u64</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> &#x3C;&#x3C;</span><span style="color:#999999;--shiki-dark:#666666"> (</span><span style="color:#2F798A;--shiki-dark:#4C9A91">8</span><span style="color:#AB5959;--shiki-dark:#CB7676"> *</span><span style="color:#B07D48;--shiki-dark:#BD976A"> byte_offset</span><span style="color:#999999;--shiki-dark:#666666">));</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">write</span><span style="color:#999999;--shiki-dark:#666666">(</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">            self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            aligned_addr</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">AddressType</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            updated_word</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#AB5959;--shiki-dark:#CB7676"> *mut</span><span style="color:#59873A;--shiki-dark:#80A665"> std</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">ffi</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#B07D48;--shiki-dark:#BD976A">c_void</span><span style="color:#999999;--shiki-dark:#666666">,</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        )</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#2E8F82;--shiki-dark:#5DA994">        Ok</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">orig_byte</span><span style="color:#1E754F;--shiki-dark:#4D9375"> as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> u8</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>å¯ä»¥çœ‹åˆ°ï¼Œè®¾ç½®æ–­ç‚¹å®é™…å°±æ˜¯å¯¹è¿™ä¸ªåœ°å€å†™å…¥äº† <code>0xcc</code>ï¼Œè¿™æ˜¯ x86 çš„ <code>int3</code> å•å­—èŠ‚æŒ‡ä»¤ï¼Œä¼šè§¦å‘ <code>SIGTRAP</code> ä¿¡å·ï¼Œä»è€Œæš‚åœå­è¿›ç¨‹çš„æ‰§è¡Œï¼Œè¾¾åˆ°è®¾ç½®æ–­ç‚¹çš„ç›®çš„ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è®°å½•äº†åŸæ¥çš„å­—èŠ‚ï¼ˆä½œä¸º <code>write_byte</code> çš„è¿”å›å€¼ï¼‰ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>è¿™å°±æ¶‰åŠåˆ°ä»æ–­ç‚¹æ¢å¤æ‰§è¡Œçš„æœºåˆ¶ã€‚æˆ‘ä»¬éœ€è¦é¦–å…ˆæ¢å¤æ–­ç‚¹çš„åŸå§‹å­—èŠ‚ï¼Œç„¶åæŠŠæŒ‡ä»¤å¯„å­˜å™¨ RIP å‡ä¸€ï¼ˆå› ä¸º <code>int3</code> æ˜¯å•å­—èŠ‚æŒ‡ä»¤ï¼‰ä»¥æŒ‡å‘åŸå§‹æŒ‡ä»¤ï¼Œè¿™æ ·å°±å¯ä»¥æ‰§è¡ŒåŸå§‹æŒ‡ä»¤äº†ã€‚ä½†æ³¨æ„ï¼Œæ­¤æ—¶å› ä¸º <code>int3</code> è¢«è¿˜åŸäº†ï¼Œæ‰€ä»¥è¯¥æ–­ç‚¹ä¹Ÿå°±ç›¸åº”å¤±æ•ˆäº†ï¼Œä¸‹æ¬¡å†æ‰§è¡Œåˆ°è¿™é‡Œæ—¶ç¨‹åºä¸ä¼šåœæ­¢ã€‚ä¸ºäº†è®©æ–­ç‚¹ä¿æŒæœ‰æ•ˆï¼Œæˆ‘ä»¬éœ€è¦é¦–å…ˆå•æ­¥æ‰§è¡Œæ–­ç‚¹å¤„åŸå§‹æŒ‡ä»¤ï¼Œç„¶åå†æ¬¡å‘è¯¥æ–­ç‚¹åœ°å€çš„å†…å­˜å†™å…¥ <code>0xcc</code> ä»¥é‡æ–°å¯ç”¨æ–­ç‚¹ã€‚æ¥ä¸‹æ¥å¯ä»¥æ­£å¸¸æ¢å¤æ‰§è¡Œäº†ã€‚</p>
<pre class="shiki shiki-themes vitesse-light vitesse-dark" style="background-color:#ffffff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee" tabindex="0"><code class="language-rust"><span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">impl</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Inferior</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">    pub</span><span style="color:#1E754F;--shiki-dark:#4D9375"> fn</span><span style="color:#59873A;--shiki-dark:#80A665"> go</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;mut</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -></span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Result</span><span style="color:#999999;--shiki-dark:#666666">&#x3C;</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Status</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#2E8F82;--shiki-dark:#5DA994">Error</span><span style="color:#999999;--shiki-dark:#666666">></span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#AB5959;--shiki-dark:#CB7676"> mut</span><span style="color:#B07D48;--shiki-dark:#BD976A"> regs</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#59873A;--shiki-dark:#80A665"> ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">getregs</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">())</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#AB5959;--shiki-dark:#CB7676">        let</span><span style="color:#B07D48;--shiki-dark:#BD976A"> rip</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#B07D48;--shiki-dark:#BD976A"> regs</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">rip </span><span style="color:#1E754F;--shiki-dark:#4D9375">as</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> usize</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#1E754F;--shiki-dark:#4D9375">        if</span><span style="color:#AB5959;--shiki-dark:#CB7676"> let</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> Some</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">bp</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#999999;--shiki-dark:#666666"> =</span><span style="color:#A65E2B;--shiki-dark:#C99076"> self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">breakpoints</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">get</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#AB5959;--shiki-dark:#CB7676">&#x26;</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">))</span><span style="color:#999999;--shiki-dark:#666666"> {</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">            self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">write_byte</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#B07D48;--shiki-dark:#BD976A"> bp</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">orig_byte</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#B07D48;--shiki-dark:#BD976A">            regs</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#393A34;--shiki-dark:#DBD7CAEE">rip </span><span style="color:#999999;--shiki-dark:#666666">-=</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">            ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">setregs</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#B07D48;--shiki-dark:#BD976A"> regs</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">            ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">step</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">            self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">            self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">write_byte</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#B07D48;--shiki-dark:#BD976A">rip</span><span style="color:#AB5959;--shiki-dark:#CB7676"> -</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 1</span><span style="color:#999999;--shiki-dark:#666666">,</span><span style="color:#2F798A;--shiki-dark:#4C9A91"> 0xcc</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#59873A;--shiki-dark:#80A665">        nix</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">sys</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">ptrace</span><span style="color:#AB5959;--shiki-dark:#CB7676">::</span><span style="color:#59873A;--shiki-dark:#80A665">cont</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#A65E2B;--shiki-dark:#C99076">self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">pid</span><span style="color:#999999;--shiki-dark:#666666">(),</span><span style="color:#2E8F82;--shiki-dark:#5DA994"> None</span><span style="color:#999999;--shiki-dark:#666666">)</span><span style="color:#AB5959;--shiki-dark:#CB7676">?</span><span style="color:#999999;--shiki-dark:#666666">;</span></span>
<span class="line"><span style="color:#A65E2B;--shiki-dark:#C99076">        self</span><span style="color:#AB5959;--shiki-dark:#CB7676">.</span><span style="color:#59873A;--shiki-dark:#80A665">wait</span><span style="color:#999999;--shiki-dark:#666666">(</span><span style="color:#2E8F82;--shiki-dark:#5DA994">None</span><span style="color:#999999;--shiki-dark:#666666">)</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">    }</span></span>
<span class="line"><span style="color:#999999;--shiki-dark:#666666">}</span></span></code></pre>
<p>å®Œç»“æ’’èŠ±ï¼Îµ=Îµ=(ãƒâ‰§âˆ‡â‰¦)ãƒ</p>
<h2 id="%E5%90%8E%E8%AE%B0" tabindex="-1">åè®°</h2>
<p>æ²¡æƒ³åˆ°è‚ä¸€ç¯‡é€ patch è®°å½•çš„æ–‡ç« è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ï¼Œè™½ç„¶è¿™ç¯‡æ–‡ç« çš„å†…å®¹å¹¶ä¸æ˜¯å¾ˆæœ‰æ·±åº¦ã€‚ä¸è¿‡ï¼Œè¿™ç¯‡æ–‡ç« çš„å†…å®¹ä¹Ÿç®—æ˜¯æˆ‘åœ¨å­¦ä¹ æ“ä½œç³»ç»Ÿå’Œ Rust æ—¶çš„ä¸€ä¸ªå°å°çš„æ€»ç»“å§ã€‚</p>
<blockquote>
<p>ä»¥ä¸Šæ˜¯ Copilot æŠ¢ç­”çš„ï¼Œæˆ‘åªæ˜¯æƒ³è¯´é€ patch å†™å¤ªç´¯äº†ã€‚ã€‚ã€‚å°¤å…¶æ˜¯å†™ä½œçš„æ—¶å€™è¿˜è°ƒæ•´äº†ä¸€ä¸‹éƒ¨åˆ†é”™è¯¯å¤„ç†çš„å®ç°ï¼Œéœ€è¦é€ä¸ª patch ç§»æ¤ã€‚</p>
</blockquote>
<p>æ¯ä¸ªå°ç« èŠ‚çš„æ ‡é¢˜ neta äº† <a href="https://bangumi.tv/subject/9781" target="_blank" rel="noopener">GOSICK -ã‚´ã‚·ãƒƒã‚¯-</a>ï¼Œå¾ˆæµªæ¼«çš„ä¸€éƒ¨åŠ¨ç”»ï¼Œæ¨èä¸€ä¸‹ã€‚</p>
<p>å¦‚æœä½ èƒ½çœ‹åˆ°è¿™é‡Œï¼Œå‘ä½ è¡¨ç¤ºæ„Ÿè°¢ï¼</p>
